.\" Manpage for Plugin_tx2mon
.\" Contact ovis-help@sandia.gov to correct errors or typos.
.TH man 7 "25 Dec 2020" "v4.3" "LDMS Plugin tx2mon man page"

.SH NAME
Plugin_tx2mon - man page for the LDMS tx2mon plugin

.SH SYNOPSIS
Within ldmsd_controller
.br
config name=tx2mon [ <attr> = <value> ]

.SH DESCRIPTION
The tx2mon plugin provides cpu and soc information from /sys/bus/platform/devices/tx2mon/[socinfo, node<i>_raw]. Socinfo contains information about the number of cpus, cores and thread on the system while node<i>_raw contains values about each cpu identified (where i is an integer that identifies the cpu information). The values gathered from node<i>_cpu is then mapped to the data structure in /usr/include/tx2mon/mc_oper_region.h.

.SH CONFIGURATION ATTRIBUTE SYNTAX

.TP
.BR config
name=<plugin_name> component_id=<comp_id> set=<set_name> [noarray=<bool>]
.br
 configuration line
.RS
.TP
name=<plugin_name>
.br
This MUST be tx2mon.
.TP
producer=<pname>
.br
The producer string value.
.TP
instance=<set_name>
.br
The name of the metric set.
.TP
schema=<schema>
.br
Optional schema name. It is required by most storage backends that the same sampler on different nodes with different metric subsets needs to have a unique schema name. Use auto-schema=1 instead of schema to automatically meet the backend requirement.
.TP
auto-schema=<bool>
.br
If true, change the schema name to tx2mon_$X, where $X will be
a unique hex value derived from the data selection options. If both schema and auto-schema are given, for backward-compatibility auto-schema is ignored for the tx2mon plugin.
.TP
component_id=<comp_id>
.br
The component id numerical value.
.TP
noarray=<bool>
.br
Include the metrics from /user/include/mc_oper_region.sh and max and min values from all array metrics. If false (0) all metric array values will be included.
.RE

.SH DATA
This reports metrics from /usr/include/tx2mon/mc_oper_region.h by default. If arrays are turned off (noarray=true) then only the max and min metric values of each array are included and all other values are supressed.
Units on the /mc_oper_region.h metric values are uint32_t. The array, tmon_cpu, has uint16_t types.

.SH EXAMPLES 
.PP
Within ldmsd_controller or a configuration file:
.nf
load name=tx2mon
config name=tx2mon producer=vm1_1 component_id=1 instance=vm1_1/tx2mon
start name=tx2mon interval=1000000
.fi

.SH NOTES
.PP
The definitions of all structure metrics in /usr/include/tx2mon/mc_oper_region.h are as follows. All resv<i> have been omitted from the metric list.
uint32_t	cmd_status;			
uint32_t	counter;			Snapshot value of the cpu. Reported as a string integer.
uint32_t	temp_abs_max;			Absolute maximum limit of temperature beyond which the SoC will throttle voltage and frequency down.
uint32_t	temp_soft_thresh;		Soft limit of temperature beyond which the SoC will throttle voltage and frequency down.
uint32_t	temp_hard_thresh;		Hard limit of temperature beyond which the SoC will throttle voltage and frequency down.
uint32_t	freq_cpu[MAX_CPUS_PER_SOC];	Frequency reading of each core. 
uint16_t	tmon_cpu[MAX_CPUS_PER_SOC];	Temperature reading of each core. Converted to temp in C.
uint32_t	tmon_soc_avg;			Average temperature on the SoC. Converted to temp in C.
uint32_t	freq_mem_net;			Frequency reading of the SoC and ring connection. More information can be found on ThunderX2 HRM.
uint32_t	freq_socs;			Internal block frequency.
uint32_t	freq_socn;			Internal block frequency.
uint32_t	freq_max;			Maximum limit of SoC frequency. Depend on the SKU.
uint32_t	freq_min;			Minimum limit of SoC frequency. Depend on the SKU.
uint32_t	pwr_core;			Power consumed by all cores on the SoC. Converted to power (W).
uint32_t	pwr_sram;			Power consumed by all internal SRAM on the SoC. Converted to power (W).
uint32_t	pwr_mem;			Power consumed by the LLC ring on the SoC. Converted to power (W). More information can be found on the ThunderX2 HRM.
uint32_t	pwr_soc;			Power consumed by SoC blocks that are misc. Converted to power (W).
uint32_t	v_core;				Voltage consumed by all cores on the SoC. Converted to voltage (V).
uint32_t	v_sram;				Voltage consumed by all internal SRAM on the SoC. Converted to voltage (V).
uint32_t	v_mem;				Voltage consumed by the LLC ring on the SoC. Converted to voltage (V). More information can be found on the ThunderX2 HRM.
uint32_t	v_soc;				Voltage consumed by SoC blocks that are misc. Converted to voltage (V).
uint32_t	active_evt;			Provides a list of active evens that are causing throttling. Converted to voltage (V).
uint32_t	temp_evt_cnt;			Total number of temperature events.
uint32_t	pwr_evt_cnt;			Total number of power events.
uint32_t	ext_evt_cnt;			Total number of exteral events.
uint32_t	temp_throttle_ms;		Time duration of all temperature events in ms.
uint32_t	pwr_throttle_ms;		Time duration of all power events in ms.
uint32_t	ext_throttle_ms;		Time duration of all external events in ms.

The structure /usr/include/tx2mon/mc_oper_region.h is recycled for each new /sys/bus/platform/devices/tx2mon/node<i>_raw identified.
.PP
Requesting noarray (which may be high overhead) requires explicitly requesting it. 
.PP

.SH SEE ALSO
ldmsd(8), README file for tx2mon plugin. 
